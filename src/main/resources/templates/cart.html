<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
</head>
<body>
<h1>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>

<div th:if="${cart.cartItems.isEmpty()}">
    <p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
</div>

<div th:unless="${cart.cartItems.isEmpty()}">
    <table border="1">
        <thead>
        <tr>
            <th>–ö–∞—Ä—Ç–∏–Ω–∫–∞</th>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${cart.cartItems}">
            <td><img th:src="@{${item.product.imageUrl}}" alt="Product Image" width="50"></td>
            <td th:text="${item.product.name}"></td>
            <td th:text="${item.product.price} + ' ‚ÇΩ'"></td>
            <td>
                <form method="post" th:action="@{/cart/update}" style="display:inline;">
                    <input type="hidden" name="productId" th:value="${item.product.id}">
                    <input type="number" name="quantity" th:value="${item.quantity}" min="1">
                    <button type="submit">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </form>
            </td>
            <td>
                <form method="post" th:action="@{/cart/remove}" style="display:inline;">
                    <input type="hidden" name="productId" th:value="${item.product.id}">
                    <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <h3>–û–±—â–∞—è —Å—É–º–º–∞: <span th:text="${cart.totalPrice} + ' ‚ÇΩ'"></span></h3>

    <form method="post" th:action="@{/orders/checkout}">
        <button type="submit">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </form>

</div>

<p><a href="/products">üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω</a></p>

<div id="notification" style="
    display: none;
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #4CAF50;
    color: white;
    padding: 15px;
    border-radius: 5px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
">
    <span id="notification-message"></span>
</div>

<script>
    function showNotification(message) {
        let notification = document.getElementById("notification");
        let messageSpan = document.getElementById("notification-message");
        messageSpan.textContent = message;
        notification.style.display = "block";

        setTimeout(function () {
            notification.style.display = "none";
        }, 2000);
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("form").forEach(form => {
            let method = form.getAttribute("method").toUpperCase();

            if (method === "GET") {
                return;
            }

            form.addEventListener("submit", function (event) {
                event.preventDefault();

                let formData = new FormData(form);
                let actionUrl = form.getAttribute("action");

                fetch(actionUrl, {
                    method: "POST",
                    body: formData
                }).then(response => {
                    if (response.ok) {
                        let message = "–î–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!";
                        if (actionUrl.includes("/cart/remove")) {
                            message = "–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è!";
                        } else if (actionUrl.includes("/cart/update")) {
                            message = "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è!";
                        } else if (actionUrl.includes("/cart/checkout")) {
                            message = "–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!";
                        }
                        showNotification(message);
                    } else {
                        showNotification("–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è!");
                    }
                }).catch(() => {
                    showNotification("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏!");
                });
            });
        });
    });
</script>

</body>
</html>